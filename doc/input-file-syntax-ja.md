# SimuDia用入力ファイル仕様書 (日本語)

取り消し線で表示されている部分は、将来実装されます。

## 全般

* `#` で始まる行は無視されます。コメントを表記するのに使います。
* 空行は無視されます。
* 行頭行末の空白は無視されます。任意でインデントを行うことができます。
* ファイル全体は `[` ~ `]` で指定されるセクションによって分けられます。
  例えば、`[General]`から`[Stations]`までの部分がGeneralセクションです。
* セクション名の前後の空白は無視されます。
* セクションの順番は必ず、`[General]`→`[Stations]`→`[RawTimes]`→`[Lines]`となっている必要があります。
* `[General]`セクションの前に意味のある行がある場合は ~~構文エラーとなります。~~ 無視されます。

## 値の形式

以下で用いられる値の形式の一覧です。

|形式名|制約|
|------|----|
|color|`#RRGGBB`の16進数形式。内部的には`ColorTranslator.FromHtml()`でパースできる必要があります。|
|decimal|数。小数が許容されます。|
|integer|整数。内部的には`int.Parse()`でパースできる必要があります。|
|string|文字列。`"`は必要ありません。|
|time|`mmss`, `Hmmss` ~~, `mm:ss`, `H:mm:ss`~~ のいずれかの形式。|
|time_offset|time形式の先頭に`+`または`-`が付加可能。省略された場合は正と見なされます。|

## [General] セクション

ファイル全体に関わるプロパティを記述します。

* 各行は`プロパティ名=値`の形式です。`=`の前後にある空白は無視されます。

|プロパティ名|値の形式|プロパティの意味|
|------------|--------|----------------|
|`month_length`|time|__必須。__ Extendedのゲーム内における1ヶ月の長さ。|
|`shift_divisor`|int|__必須。__ ~~正の数。~~ Extendedのゲーム内で、時刻表のshift値が1ヶ月を何分割するか。コンフィグの`spacing_shift_divisor`の値。|
|`default_loading_time`|time|デフォルト値0030 (30秒)。ファイル全体でデフォルトで使われる乗降時間の長さ。|
|`default_reversing_time`|time|デフォルト値0100 (1分)。ファイル全体でデフォルトで使われる折り返し時間の長さ。|

## [Stations] セクション

ダイヤグラムで用いる駅の一覧を記述します。

* 駅の形式は、`駅名`あるいは`駅名@ID`です。IDはint形式です。IDを省略した場合は`0`となります。
* IDは、同じ名前の駅を複数登録する場合に別の値を取る必要があります。基本的には分岐線を表示するためのものです。
* ~~名前もIDも同じ駅が登録された場合にはエラーとなります。~~
* 入力した順番が経路と見なされ、ダイヤグラムの駅はこの順番に表示されます。

## [RawTimes] セクション

駅間の所要時間を記述します。

* 各行の形式は、`<プロパティリスト>出発駅->到着駅:所要時間リスト`です。`プロパティリスト`は省略でき、`<` `>` ->` `:`の前後の空白は無視されます。
* 所要時間リストは`出発時間-到着時間`あるいは`所要時間`の要素を1つ以上、`,`で区切って記述します。形式は全てtimeです。`,`の前後の空白は無視されます。
* `出発時間-到着時間`の形式はゲーム内での時間をそのまま入力することに特化しています。出発時間より到着時間が遅い場合には、月を跨いだものとして所要時間が計算されます。
* プロパティリストは`プロパティ名=値`の要素を1つ以上、`,`で区切って記述します。`=`や`,`の前後の空白は無視されます。
* 同じ区間の時間データが複数存在する場合、計算にはそれらの平均値が用いられます。

|プロパティ名|値の形式|プロパティの意味|
|------------|--------|----------------|
|`time_id`|int|デフォルト値0。同じ区間でも所要時間を区別しなければならない場合に、これを別の値にします。なお、同じ区間と`time_id`を持つものが複数の行に存在しても、正常に登録されます。|

## [Lines] セクション

路線を定義します。

* 各路線は、`-`で始まる行によって区切られます。
* 路線ごとに、プロパティと停車駅リストを指定します。

### プロパティ

* 行が`プロパティ名=値`の形式で完結している場合、プロパティとして解釈されます。`=`の前後の空白は無視されます。

|プロパティ名|値の形式|プロパティの意味|
|------------|--------|----------------|
|`name`|string|__必須。__ 路線の種別名を指定します。|
|`divisor`|int|__必須。__ ~~正の数。~~ 1ヶ月に発車する回数。ゲーム内で、時刻表のDepartures per monthの値に対応。|
|`divisor_by_every`|time|`divisor`の代わりに指定可能。両方指定された場合は`divisor`が優先。発車間隔。近い`divisor`値に ~~丸め~~ 切り捨てられます。|
|`width`|decimal|デフォルト値1.0。 ~~正の数。~~ ダイヤグラムで表示される線の太さ。|
|`color`|color|デフォルト値#000000。ダイヤグラムで表示される線の色。|
|`default_loading_time`|time|この路線でデフォルトで使われる乗降時間の長さ。省略した場合は`[General]`の対応する値が使われます。|
|`default_reversing_time`|time|この路線でデフォルトで使われる折り返し時間の長さ。省略した場合は`[General]`の対応する値が使われます。|
|`default_time_id`|int|デフォルト値0。この路線でデフォルトで使われる`time_id`の値。|

### 停車駅リスト

* プロパティとして解釈されない場合、停車駅リストとして解釈されます。形式は`停車駅`または`<プロパティリスト>停車駅`です。 `<`や`>`の前後の空白は無視されます。
* プロパティリストは`プロパティ名=値`あるいは`プロパティ名`の要素を1つ以上、`,`で区切って記述します。`=`や`,`の前後の空白は無視されます。
* 停車駅リストは最後の駅から最初の駅までの移動を含めて1周となります。

|プロパティ名|値の形式|プロパティの意味|
|------------|--------|----------------|
|`shift`|time|この駅を発車する時刻のオフセット。ゲーム内のshift値を時刻の形式で指定したもの。|
|`shift_num`|int|この駅を発車する時刻のオフセット。ゲーム内のshift値そのもの。`shift`より優先されます。|
|`wait`|time|この駅に到着してからの停車時間。指定された場合、到着時間に停車時間を足したものが発車時刻のオフセットになります。`shift_num`より優先されます。|
|`load`|time|この駅に到着してからの乗降時間。省略された場合は路線やファイル全体のデフォルト値が用いられます。|
|`reverse`|(time)|指定された場合、この駅に到着してからの折り返し時間が追加されます。値が省略された場合、路線やファイル全体のデフォルト値が用いられます。|
|`time_id`|int|デフォルト値0。次の駅への移動時間。`[RawTimes]`に指定されたIDと対応し、その移動時間が用いられます。|
|`trip`|time|次の駅への移動時間。`time_id`より優先されます。|
|`trip_offset`|time_offset|次の駅への移動時間の増減。`[RawTimes]`や`trip`から算出された時間にこの値が加算され、最終的な移動時間となります。|

### 2種類の停車時間

停車時間には「指定された停車時間」と「必要な停車時間」の2種類があります。
「指定された停車時間」は、`shift`, `shift_num`, `wait`が指定された場合に有効となり、駅を発車する時刻と駅に到着する時刻の差で与えられます。
「必要な停車時間」は、乗降時間(`wait`)と(指定された場合のみ)折り返し時間(`reverse`)のうちの長い方です。
「指定された停車時間」が存在しない場合、「必要な停車時間」を基にして自動的に発車時刻が計算されます。
「指定された停車時間」が「必要な停車時間」を下回った場合、 ~~警告が出力されますが、~~ ダイヤグラム上では問答無用で「指定された停車時間」を基にして設定されます。
